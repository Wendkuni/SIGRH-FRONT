<p-toast
  [showTransformOptions]="'translateY(100%)'"
  [showTransitionOptions]="'1000ms'"
  [hideTransitionOptions]="'1000ms'"
  [showTransformOptions]="'translateX(100%)'" />
<p-confirmDialog />
<div class="flex justify-content-between border-bottom-1 surface-border p-3">
  <span class="block text-900 font-bold text-xl mb-4">Carrières</span>
</div>
<div class="grid">
  <div class="col-12 lg:col-5">
    <span class="text-sm m-3">
                Champs obligatoires:
                <span class="text-red-500">*</span>
              </span>
    <form [formGroup]="fonctionAgentForm">
      <div class="border-1 surface-border border-round p-fluid mb-4">
        <span class="text-900 font-bold block border-bottom-1 surface-border p-3">Fonction Agent</span>
        <div class="p-3">
          <div class="field">
            <label for="matricule">Matricule</label>
            <input
              type="text"
              pInputText
              id="matricule"
              [value]="personnel.matricule"
              required
              disabled/>
          </div>
          <div class="field">
            <label for="fullName">Nom Prenom</label>
            <input
              type="text"
              pInputText
              id="fullName"
              [value]="personnel.nomPrenom"
              required
              disabled/>
          </div>
          <div class="field">
            <label for="nature" class="font-medium text-900">Nature <span class="text-red-500">*</span></label>
            <p-dropdown
              id="nature"
              formControlName="nature"
              [options]="categorie"
              placeholder="Selectionner la categorie"
            >
            </p-dropdown>
            <mrt-form-validators [entityField]="'categorie'"
                                 [formGroup]="fonctionAgentForm"></mrt-form-validators>
          </div>
          <div class="field">
            <label for="dateDebFonction" class="font-medium text-900"> Date Effet <span class="text-red-500">*</span></label>
            <p-calendar
              id="dateDebFonction"
              formControlName="dateDebFonction"
              [dateFormat]="'yy-mm-dd'"
              [showButtonBar]="true"
              [firstDayOfWeek]="1"
              [readonlyInput]="true"
              styleClass="mb-1"
            />
            <mrt-form-validators [entityField]="'dateDebFonction'"
                                 [formGroup]="fonctionAgentForm"></mrt-form-validators>
          </div>
        </div>
        <div class="border-1 surface-border border-round p-fluid m-2">
          <span class="text-900 font-bold block  border-bottom-1 surface-border p-3">INCIDENCE, GRADE, ECHELLE ET ECHELLON</span>
          <div class="p-3">
            <div class="field">
              <label for="corps" class="font-medium text-900">CORPS <span class="text-red-500">*</span></label>
              <p-dropdown
                id="corps"
                placeholder="Selectionner la nature"
                formControlName="corps"
              >
              </p-dropdown>
              <mrt-form-validators [entityField]="'corps'"
                                   [formGroup]="fonctionAgentForm"></mrt-form-validators>
            </div>
            <div class="field">
              <label for="fonction" class="font-medium text-900">Fonction <span class="text-red-500">*</span></label>
              <p-dropdown
                id="fonction"
                placeholder="Selectionner la fonction"
                formControlName="libelleFonction"
              >
              </p-dropdown>
              <mrt-form-validators [entityField]="'libelleFonction'"
                                   [formGroup]="fonctionAgentForm"></mrt-form-validators>
            </div>
            <div class="field">
              <label for="grade" class="font-medium text-900">Grade <span class="text-red-500">*</span></label>
              <p-dropdown
                id="grade"
                placeholder="Selectionner le grade"
                formControlName="grade"
              >
              </p-dropdown>
              <mrt-form-validators [entityField]="'grade'"
                                   [formGroup]="fonctionAgentForm"></mrt-form-validators>
            </div>
            <div class="field " >
              <label for="echelle" class="font-medium text-900">Echelle <span class="text-red-500">*</span></label>
              <p-dropdown
                id="echelle"
                placeholder="Selectionner l'echelle"
                formControlName="echelle"
              >
              </p-dropdown>
              <mrt-form-validators [entityField]="'echelle'"
                                   [formGroup]="fonctionAgentForm"></mrt-form-validators>
            </div>
            <div class="field ">
              <label for="echelon" class="font-medium text-900">Echelon <span class="text-red-500">*</span></label>
              <p-dropdown
                id="echelon"
                placeholder="Selectionner l'echelon"
                formControlName="echelon"
              >
              </p-dropdown>
              <mrt-form-validators [entityField]="'echelon'"
                                   [formGroup]="fonctionAgentForm"></mrt-form-validators>
            </div>
          </div>
        </div>
      </div>
      <div class="flex justify-content-between gap-3">
        <button pButton pRipple class="p-button-primary flex-1" label="Enregistrer"
                [disabled]="fonctionAgentForm.invalid"
                icon="pi pi-fw pi-check"></button>
        <button pButton pRipple
                class="p-button-danger flex-1 p-button-outlined"
                label="Annuler" icon="pi pi-fw pi-times"
                (click)="cancel()"
        ></button>
      </div>
    </form>
  </div>
  <div class="col-12 lg:col-7">
    <p-table
      [columns]="cols"
      [value]="listeFonctionByAgent"
      #dt1
      dataKey="id"
      [rows]="5"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Page {currentPage} sur {totalPages}"
      [paginator]="true"
      styleClass="p-datatable-gridlines p-datatable-striped"
      responsiveLayout="scroll"
      [rowHover]="true"
      [rowsPerPageOptions]="[5,10]"
      tableStyleClass="p-datatable-gridlines"
    >
      <ng-template let-columns pTemplate="header">
        <tr>
          @for (col of columns; track col.field) {
            <th
              style="min-width: 15rem"
              [pSortableColumn]="col.field"
              class="font-weight-bold"
            >
              {{ col.header }}
              <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
          }
          <th></th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-avancement>
        <tr>
          <td>{{ avancement.libelleFonction }}</td>
          <td>{{ avancement.libelleFonctionArab }}</td>
          <td>{{ avancement.dateDebutFonction  | uppercase }}</td>
          <td>{{ avancement.categorie }}</td>
          <td>{{ avancement.corps }}</td>
          <td>{{ avancement.corpsArab }}</td>
          <td>{{ avancement.grade }}</td>
          <td>{{ avancement.groupe }}</td>
          <td>{{ avancement.echelle }}</td>
          <td>{{ avancement.echelon }}</td>
          <td>{{ avancement.indice }}</td>
          <td>
            <!--          Bouton qui fait l'ouverture du formulaire de modification -->
            <button
              pButton
              type="button"
              pTooltip="Modifier"
              tooltipPosition="top"
              pRipple
              icon="pi pi-pencil"
              class="p-button-rounded p-button-primary mx-2"
              iconPos="left"
              (click)="patchForm(avancement)"
            ></button>
          </td>
          <td>
            <!--          Bouton qui fait la validation de l'avancement  -->
            <button
              pButton
              type="button"
              pTooltip="Valider"
              tooltipPosition="top"
              pRipple
              icon="pi pi-check-circle"
              class="p-button-rounded p-button-warning mx-2"
              iconPos="left"
            ></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">Aucun élement trouvé(e).</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
