<!-- Toast notification part start-->
<p-toast
  [showTransformOptions]="'translateY(100%)'"
  [showTransitionOptions]="'1000ms'"
  [hideTransitionOptions]="'1000ms'"
  [showTransformOptions]="'translateX(100%)'"/>
<p-confirmDialog/>

<p-toolbar styleClass="mb-4 gap-2">
  <ng-template pTemplate="left">
    <div class="text-900 font-bold text-3xl mb-4 mt-2">
      Formulaire agents admis aux écoles de formation
    </div>
  </ng-template>

  <ng-template pTemplate="right">
    <p-button
      severity="success"
      label="Ajouter"
      icon="pi pi-plus"
      class="mr-2"
      (click)="showFormDialog()"
    />
  </ng-template>
</p-toolbar>

<p-table
  [columns]="colListePersonnels"
  #personnelTable
  dataKey="id"
  [rows]="5"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="Page {currentPage} sur {totalPages}"
  [paginator]="true"
  styleClass="p-datatable-gridlines p-datatable-striped"
  responsiveLayout="scroll"
  [rowHover]="true"
  [rowsPerPageOptions]="[5,10, 20, 50]"
  tableStyleClass="p-datatable-gridlines"
  [globalFilterFields]="['nni','nomPrenom','nomPrenomArab','nni','dteRecrutement','lieuNaiss','bank','codeBank','ministereOrigine','typeeducation']"
>
  <ng-template pTemplate="caption">
    <div class="flex justify-content-between flex-column sm:flex-row">
              <span class="p-input-icon-left mb-2">
							<i class="pi pi-search"></i>
							<input pInputText type="text" #filter (input)="onGlobalFilter(personnelTable, $event)"
                placeholder="Recherche..." class="w-full"/>
						</span>
    </div>
  </ng-template>

  <ng-template let-columns pTemplate="header">
    <tr>
      @for (col of columns; track col.field) {
        <th
          [pSortableColumn]="col.field"
          class="font-weight-bold "
          style="min-width: 13rem;"
        >
          {{ col.header }}
          @if (col.header != 'Photo') {
            <p-sortIcon [field]="col.field"></p-sortIcon>
          }
        </th>
      }
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </ng-template>
</p-table>

<!-- Formulaire d'ajout et de modification d'un personnel-->
<p-dialog
  header="Formulaire du personnel"
  [(visible)]="formDialog"
  (onHide)="close()"
  [style]="{ width: '60vw' }"
  [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [maximizable]="true"
  [draggable]="false"
  [resizable]="false"
  class="p-fluid"
>
  <ng-template pTemplate="content">
    <div class="container py-5">
      <form>
        <div class="col-12">
          <div class="card">
            <div class="field col-12">
              <label for="selectedStudent" class="font-medium text-900">Selectionner l'eleve </label>
              <p-dropdown
                id="selectedStudent"
                [options]="listePersonnels"
                optionLabel="nomEtPrenom"
                [(ngModel)]="selectedPersonnel"
                [ngModelOptions]="{standalone: true}"
                [filter]="true"
                filterBy="nni"
                [showClear]="true"
                appendTo="body"
                placeholder="Rechercher par le NNI">
                <ng-template let-eleve pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>{{ eleve.nni }}</div>
                    <div>{{ eleve.nomEtPrenom }}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </div>
          <div class="card">
            <!--          Informations personnels de l'agent-->

            <div class="flex justify-content-between border-bottom-1 surface-border p-3">
              <span class="font-semibold text-color-secondary text-xl">Informations personnelles</span>
            </div>

            <div class="p-fluid p-formgrid grid mt-2">

              <!--              Nom Prenom-->
              <div class="field col-12 md:col-6">
                <label for="nometprenom" class="font-medium text-900">Nom et Prénom </label> <input id="nometprenom"
                [(ngModel)]="selectedPersonnel.nomEtPrenom" [ngModelOptions]="{standalone: true}"
                pInputText class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--              Nom Prenom Arab-->
              <div class="field col-12 md:col-6">
                <label for="nometprenomarab" class="font-medium text-900">Nom et Prénom Arab </label> <input
                [(ngModel)]="selectedPersonnel.nomPrenomArab" [ngModelOptions]="{standalone: true}"
                id="nometprenomarab" pInputText class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--              Numero de telephone-->
              <div class="field col-12 md:col-4">
                <label for="tlphone" class="font-medium text-900">Numero de telephone</label> <input id="tlphone"
                [(ngModel)]="selectedPersonnel.tlphone" [ngModelOptions]="{standalone: true}"
                pInputText class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--            Date de naissance  -->
              <div class="field col-12 md:col-4">
                <label for="dtenaiss" class="font-medium text-900">Date de naissance </label>
                <p-calendar
                  id="dtenaiss"
                  [dateFormat]="'yy-mm-dd'"
                  placeholder="Entre la date(yyyy-mm-dd)"
                  styleClass="mb-1"
                  [(ngModel)]="selectedPersonnel.dteNaiss"
                  [ngModelOptions]="{standalone: true}"
                  appendTo="body"
                  [showTime]="false"
                />
              </div>

              <!--              Lieu de naissance-->
              <div class="field col-12 md:col-4">
                <label for="lieunaiss" class="font-medium text-900">Lieu de naissance</label> <input id="lieunaiss"
                [(ngModel)]="selectedPersonnel.lieuNaiss" [ngModelOptions]="{standalone: true}"
                pInputText class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--          Adresse de l'agent    -->
              <div class="field col-12 md:col-12">
                <label for="adressemp" class="font-medium text-900">Adresse de l'agent</label> <input id="adressemp"
                [(ngModel)]="selectedPersonnel.adressEmp" [ngModelOptions]="{standalone: true}"
                pInputText class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

            </div>
            <p-divider></p-divider>
            <!--          Information relatif a l'emploi-->
            <h5>Informations relatif au metier</h5>
            <div class="p-fluid p-formgrid grid">

              <!--              NNI-->
              <div class="field col-12 md:col-6">
                <label for="nni" class="font-medium text-900">NNI </label> <input pInputText id="nni"
                [(ngModel)]="selectedPersonnel.nni" [ngModelOptions]="{standalone: true}"
                class="w-full p-component p-element form-control mb-1" type="text" disabled/>
              </div>

              <!--              Bank-->
              <div class="field col-12 md:col-6">
                <label for="bank" class="font-medium text-900">Bank </label> <input id="bank" pInputText
                [(ngModel)]="selectedPersonnel.bank" [ngModelOptions]="{standalone: true}"
                class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--              Code Bank-->
              <div class="field col-12 md:col-6">
                <label for="codebank" class="font-medium text-900">Code Bank </label> <input id="codebank" pInputText
                [(ngModel)]="selectedPersonnel.codeBank" [ngModelOptions]="{standalone: true}"
                class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--              Numero Compte-->
              <div class="field col-12 md:col-6">
                <label for="numeroCompte" class="font-medium text-900">Numero Compte </label> <input id="numeroCompte"
                [(ngModel)]="selectedPersonnel.numeroCompte" [ngModelOptions]="{standalone: true}"
                pInputText class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--              Cle Rib-->
              <div class="field col-12 md:col-6">
                <label for="cleRib" class="font-medium text-900">Clé rib </label> <input id="cleRib" pInputText
                [(ngModel)]="selectedPersonnel.cleRib" [ngModelOptions]="{standalone: true}"
                class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--              Status Employe-->
              <div class="field col-12 md:col-6">
                <label for="statusEmp" class="font-medium text-900">Statut employé</label>
                <p-dropdown
                  id="statusEmp"
                  placeholder="Selectionner le status"
                >
                </p-dropdown>
              </div>


              <!--              Detacher    -->
              <div class="field col-12 md:col-6">
                <label for="detacher" class="font-medium text-900">Service </label> <input id="detacher" pInputText
                class="w-full p-component p-element form-control mb-1" type="text"/>
              </div>

              <!--              Type Education -->
              <div class="field col-12 md:col-6">
                <label for="typeEducation" class="font-medium text-900">Type agents </label>
                <p-dropdown
                  id="typeEducation"
                  [options]="typeEducation"
                  placeholder="Choisir le type d'agent"
                >
                </p-dropdown>
              </div>

              <!--              Date recrutement -->
              <div class="field col-12 md:col-6">
                <label for="dterecrutemnt" class="font-medium text-900">Date récrutement </label>
                <p-calendar
                  id="dterecrutemnt"
                  [dateFormat]="'yy-mm-dd'"
                  placeholder="Entre la date(yyyy-mm-dd)"
                  styleClass="mb-1"
                  appendTo="body"
                  [showTime]="false"
                />
              </div>


              <!--              Avatar -->
              <div class="field col-12">
                <label class="font-medium text-900">Photo</label>
                <p-fileUpload
                  mode="basic"
                  id="avatar"
                  accept=".jpg,.jpeg,.png"
                  [maxFileSize]="1000000"
                  styleClass="p-button-outlined p-button-plain w-full"
                  chooseLabel="Choisir une image"></p-fileUpload>

              </div>
            </div>

          </div>
        </div>
      </form>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <button pButton pRipple class="p-button-primary flex-1" label="Enregistrer" icon="pi pi-fw pi-check"></button>
    <button pButton pRipple class="p-button-danger flex-1 p-button-outlined" label="Annuler"
      icon="pi pi-fw pi-times"></button>
  </ng-template>
</p-dialog>


